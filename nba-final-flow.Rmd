---
title: "NBA 2024 Final Process Mining"
author: "Author: Kurtis Smith"
date: "Published Date: TBC"
bibliography: references.bib
output: 
 html_document:
  fig_width: 10
  fig_height: 6
  theme: journal
---

## Project Introduction üëãüèΩ

Inspired by @PmInspiration, this blog will use R to explore process mining on a subject I'm fond of - basketball. I've played basketball all my life, although my failing left knee means I play infrequently in my older age. 

I'll be analysing game 5 of the 2024 NBA final between Luka's Dallas Mavericks and Jayson's Boston Celtics. Well done Celtics üçÄ, who last won a championship 16 years ago. I'll avoid findings which could just as easily be found in a games summary statistics and focus on what unique insights process mining provides. Let's start with the data.

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load packages
library(tidyverse)
library(bupaverse)
library(processanimateR)
library(patchwork)
library(DT)

# Get data
nba_2024_g5_pm_data <- read_csv("./Data/nba-final-2024-game-5.csv", col_names = TRUE)

```

## Data Treatment

The data collation was a manual effort, a labour of love. After watching game 5 of the 2024 NBA finals I painstakingly noted down each activity along with the timestamp. 

To add assurance to this data set I checked each activity available on [@nba.com/play-by-play](https://www.nba.com/game/dal-vs-bos-0042300405/play-by-play?period=All){.uri} matched on timestamp and cross checked the summary player stats against [@nba.com/box-score](https://www.nba.com/game/dal-vs-bos-0042300405/box-score?period=All){.uri}.

A few self imposed rules during data creation:

\- To define the process under analysis, one end to end run or "case" ends with a shot

\- Unless specified from the nba website I've timestamped at the beginning of each activity

## Create Eventlog

An eventlog in process mining is a structured collection of recorded events that represent the execution of activities usually within a business process, in this context, an NBA game. 

It typically contains information such as the event type, timestamp, case identifier, and other relevant attributes, serving as the primary input for process mining techniques to discover, monitor, and improve actual processes.

```{r create_eventlog}

nba_final_g5_eventlog <-  nba_2024_g5_pm_data %>% 
 mutate(lifecycle_id = "complete", 
        timestamp = ymd_hms(paste0("20240617 ", timestamp))) %>% 
 eventlog(case_id = "case_id", 
          activity_id = "activity_id", 
          activity_instance_id = "seq", 
          lifecycle_id = "lifecycle_id", 
          timestamp = "timestamp", 
          resource_id = "resource_id", 
          order = "seq", 
          validate = TRUE)

```

## Analysis {.tabset}

### Control-Flow

Control flow in process mining refers to the sequence and decision points of activities within a process. This perspective explores the flow of the game.

I could check pass repitition

```{r precedence_matrix}

nba_final_g5_eventlog %>%
 process_matrix(type = frequency("relative-case")) %>% 
 plot()


```


```{r trace_sizes}

shot_made_plot <- nba_final_g5_eventlog %>%
 filter_activity_presence("shot-make") %>%
 group_by(teams_play) %>%
 trace_length("log") %>%
 plot() +
 labs(title = "Teams Traces by Shot Made")


shot_miss_plot <- nba_final_g5_eventlog %>%
 filter_activity_presence("shot-miss") %>%
 group_by(teams_play) %>%
 trace_length("log") %>%
 plot() +
 labs(title = "Teams Traces by Shot Miss")

shot_made_plot + shot_miss_plot

```

### Performance

```{r}

# Holding

```

### Organisational

Looking at the top 10 industrious players, the players with higher frequency of activities. This is were you would expect to see your stars. 

```{r industry}

nba_final_g5_eventlog %>% 
 resource_frequency(level = "resource") %>%
 head(10) %>% 
 plot()

```

As you would expect, Tatum, Doncic, and Brown rank in the top 3. Kyrie was not as involved as Dallas would have liked. Boston hold 4 of the 5 top spots, they certainly brought the game to Dallas. 

```{r specialisation}

nba_final_g5_eventlog %>% 
 group_by(player_team) %>% 
 resource_frequency(level = "resource-activity") %>%
 filter(!resource_id %in% c("Boston Celtics", "Dallas Mavericks"), 
        !activity_id %in% c("pass", "dribble"),
        absolute > 1) %>%
 #head(10) %>% 
 plot()


```

### Multi-dimensional

```{r}
# Holding
```

### Process Map

Process mining isn't complete without a process map. Split by team plays across quarters, you could dig for many insights looking across both maps, a few to note:
\-   Boston Celtics were more industrious than Dallas. Having completed more of passes, dribbles, rebounds, blocks etc
\-   The mean average time dribbled before passing in the 4th quarter for Boston was much higher. Demonstrating a classic tactic to slow the game down, especially when your up by so many points, using your full 24 seconds means the other team have half the available time to stage a comeback.
\-   Another one

```{r process_map}

nba_final_g5_eventlog %>%
 #group_by(teams_play, quarter) %>%
 process_map(
  type_nodes = frequency("absolute"),
  type_edges = performance(mean, "secs"),
  rankdir = "TB"
 )

```


## Conclusion

Improvements

Automate data collection Have all 5 games in the data set Have included, as an activity, when players don't move with the ball. This would have been interesting to delve into. I suspect you would see the time Boston Celtics held the ball increase in quarter 4 as they attempt to run the clock.

## Acknowledgements

Packages and package maintainer(s):

-   tidyverse \| Hadley Wickham
-   bupaverse \| Gert Janssenswillen

## References
